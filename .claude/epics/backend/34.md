---
name: 内容核心CRUD系统
status: backlog
created: 2025-09-15T02:51:00Z
github: https://github.com/rcnn/sharestack/issues/34
depends_on: [001]
parallel: true
conflicts_with: []
---

# Task: 内容核心CRUD系统

## Description

实现ShareStack平台内容管理的核心CRUD操作，包括内容创建、读取、更新、删除等基础功能。建立内容数据模型和API接口，为整个内容管理系统提供基础支撑。

## Acceptance Criteria

- [ ] 完成内容创建API (/api/v1/contents/create)
- [ ] 完成内容更新API (/api/v1/contents/update)
- [ ] 完成内容删除API (/api/v1/contents/delete)
- [ ] 完成内容详情API (/api/v1/contents/detail)
- [ ] 设计并实现内容基础数据模型
- [ ] 实现内容数据验证和错误处理
- [ ] 添加内容操作的权限控制
- [ ] 编写完整的单元测试

## Technical Details

### 内容数据模型设计
- **Content表结构**:
  - id: 主键ID
  - title: 内容标题 (必填, max 200)
  - content: 内容正文 (TEXT类型)
  - summary: 内容摘要 (max 500)
  - author_id: 作者ID (外键)
  - content_type: 内容类型 (article, video, audio, document)
  - status: 内容状态 (draft, published, archived)
  - is_paid: 是否付费内容
  - price: 内容价格 (DECIMAL, 默认0)
  - created_at, updated_at: 时间戳
  - deleted_at: 软删除时间戳

### API接口规范
- **POST /api/v1/contents/create**
  - 请求体: title, content, summary, content_type, is_paid, price
  - 响应: 201 Created + 内容详情
  - 权限: 认证用户

- **PUT /api/v1/contents/{id}/update**
  - 路径参数: content_id
  - 请求体: 部分内容字段
  - 响应: 200 OK + 更新后内容
  - 权限: 内容作者或管理员

- **DELETE /api/v1/contents/{id}/delete**
  - 路径参数: content_id
  - 软删除实现
  - 响应: 204 No Content
  - 权限: 内容作者或管理员

- **GET /api/v1/contents/{id}/detail**
  - 路径参数: content_id
  - 响应: 200 OK + 内容详情
  - 权限: 根据内容权限设置

### 安全考虑
- 用户只能操作自己的内容
- 管理员可以操作所有内容
- 付费内容需要权限验证
- 输入参数严格验证和过滤
- SQL注入防护

## Dependencies

- [ ] Task 001: 后端基础架构 (数据库连接、认证系统)
- [ ] 用户管理模块提供的用户认证功能
- [ ] 数据库表结构设计完成

## Effort Estimate

- Size: L
- Hours: 24小时
- Parallel: true (可与其他内容模块并行开发)

## Definition of Done

- [ ] 所有CRUD API接口实现完成
- [ ] 内容数据模型建立并通过数据库迁移
- [ ] API接口通过Postman/Swagger测试
- [ ] 单元测试覆盖率达到90%以上
- [ ] 代码审查通过
- [ ] API文档更新完成
- [ ] 集成测试通过

## Implementation Notes

### 数据库Schema
```sql
CREATE TABLE contents (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL,
    content TEXT,
    summary VARCHAR(500),
    author_id BIGINT NOT NULL,
    content_type ENUM('article', 'video', 'audio', 'document') NOT NULL,
    status ENUM('draft', 'published', 'archived') DEFAULT 'draft',
    is_paid BOOLEAN DEFAULT FALSE,
    price DECIMAL(10,2) DEFAULT 0.00,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL,
    INDEX idx_author_id (author_id),
    INDEX idx_status (status),
    INDEX idx_content_type (content_type),
    INDEX idx_created_at (created_at),
    FOREIGN KEY (author_id) REFERENCES users(id)
);
```

### Service层设计
- ContentService: 核心业务逻辑
- ContentRepository: 数据访问层
- ContentValidator: 数据验证
- ContentPermission: 权限控制

### 错误处理
- 404: 内容不存在
- 403: 权限不足
- 400: 参数验证失败
- 422: 业务逻辑错误